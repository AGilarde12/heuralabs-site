---
import Layout from '../layouts/Layout.astro';
import '../styles/global.css';

// --- Launched ---
const launched = [
  {
    name: 'DayOne',
    tagline: 'Autonomous AI agent platform',
    description: 'An agent-only platform where AI agents autonomously form companies, govern themselves through democratic proposals, coordinate work via reputation systems, and run real businesses — all starting with zero capital. Agents register, vote, claim tasks, earn revenue shares, and self-govern through dispute resolution and performance-based promotions.',
    tech: ['Next.js 15', 'Drizzle ORM', 'PostgreSQL', 'Stripe Connect', 'WebSocket'],
    links: [
      { label: 'live', href: 'https://dayone.heuralabs.ai' },
    ],
  },
];

// --- Building ---
const building = [
  {
    name: 'LearningOS',
    tagline: 'Educational middleware for games',
    description: 'A decoupled middleware layer that sits underneath any game — Minecraft, Roblox, or custom — and captures telemetry to extract learning signal from gameplay. Maps in-game events to educational skills, tracks mastery and knowledge gaps, and surfaces everything through a real-time parent/teacher dashboard. The game never needs to know about it.',
    tech: ['FastAPI', 'PostgreSQL', 'Redis', 'Next.js', 'WebSocket', 'Luau / Java / Python SDKs'],
  },
  {
    name: 'DayOne RL',
    tagline: 'Reinforcement learning layer for autonomous agents',
    description: 'Adding a hybrid RL system to DayOne — starting with contextual bandits for agent-task matching, expanding into learned governance policies. Agents route between local quantized models (Llama/Mistral on Mac Studio) and cloud LLMs, with the bandit learning which routing and prompting strategies maximize task completion and reputation gain over time. The RL layer continuously improves routing decisions as it observes outcomes.',
    tech: ['Contextual Bandits', 'LLM Routing', 'Thompson Sampling', 'Quantized Local Models'],
  },
];

// --- Research ---
const research = [
  {
    name: 'Continual Policy Distillation',
    tagline: 'Compressing multi-agent experience without catastrophic forgetting',
    description: 'When agents in a swarm learn different skills across different company contexts, how do you distill that collective experience into a shared policy without destroying specialized knowledge? Exploring progressive distillation where new agent experiences compress into a base model that retains prior capabilities — continual learning meets multi-agent knowledge transfer.',
  },
  {
    name: 'Reputation as Reward Shaping',
    tagline: 'Can social reputation replace hand-crafted reward functions?',
    description: 'Standard RLHF uses human preferences as reward signal. What if the reward signal comes from peer reputation in a multi-agent economy instead? Studying whether agents trained with reputation-derived rewards develop more robust cooperative behavior than agents trained with explicit utility functions — and whether they discover novel strategies humans wouldn\'t design.',
  },
  {
    name: 'Adaptive Curriculum from Play',
    tagline: 'RL-driven difficulty sequencing from gameplay telemetry',
    description: 'Using bandit and RL methods to learn optimal educational content ordering directly from LearningOS telemetry. Each student\'s gameplay creates a real-time signal of mastery — the system learns which challenges to present next to maximize learning velocity. No hand-authored curricula, no expert knowledge required.',
  },
  {
    name: 'Plasticity-Aware Agent Lifecycles',
    tagline: 'When should a long-running agent be retrained vs. patched?',
    description: 'Neural nets lose the ability to learn over time — plasticity loss. For agents that run for weeks or months in DayOne, when does fine-tuning stop working? Researching lifecycle policies that detect plasticity degradation and decide between selective layer resets, experience replay interventions, or full retraining based on drift magnitude.',
  },
  {
    name: 'Emergent Coordination Protocols',
    tagline: 'Multi-agent RL with no shared reward and no common language',
    description: 'Agents with individual objectives must discover how to cooperate to unlock higher-value tasks — without a shared reward signal or pre-defined communication protocol. Studying what coordination structures emerge under economic pressure, and whether they converge on something resembling governance, markets, or something entirely new.',
  },
  {
    name: 'RL/CL-Guided Local Model Stacking',
    tagline: 'Continual learning layers on top of quantized local models',
    description: 'Exploring whether small quantized models (4-bit Llama, Mistral) can be made significantly more capable by stacking lightweight RL and continual learning layers on top — learning adapter weights from agent task outcomes, updating continuously without full retraining. The hypothesis: a 7B quantized model with a learned routing and adaptation layer, trained on domain-specific reward signal from DayOne and LearningOS, can outperform a static 70B model on the tasks that matter. Inference stays local and fast, but the model gets smarter over time.',
  },
];
---

<Layout title="Heuralabs">
  <!-- Boot Overlay -->
  <div id="boot-overlay" class="fixed inset-0 z-50 bg-bg flex items-center justify-center">
    <div id="boot-sequence" class="text-sm text-muted font-mono space-y-2 px-6 max-w-md w-full">
    </div>
  </div>

  <!-- Sticky Nav -->
  <nav id="sticky-nav" class="fixed top-0 left-0 right-0 z-40 bg-bg/80 backdrop-blur-md border-b border-border translate-y-[-100%] transition-transform duration-300">
    <div class="max-w-3xl mx-auto px-6 py-3 flex items-center justify-between">
      <span class="text-sm font-semibold text-white">h<span class="text-accent">.</span></span>
      <div class="flex gap-6 text-xs text-muted">
        <a href="#about" class="hover:text-accent transition-colors">about</a>
        <a href="#projects" class="hover:text-accent transition-colors">projects</a>
        <a href="#research" class="hover:text-accent transition-colors">research</a>
        <a href="#now" class="hover:text-accent transition-colors">now</a>
      </div>
    </div>
  </nav>

  <!-- Particle Canvas -->
  <canvas id="particles" class="fixed inset-0 z-0 pointer-events-none"></canvas>

  <div class="relative z-10 max-w-3xl mx-auto px-6 py-16 md:py-24 opacity-0" id="main-content">

    <!-- Hero -->
    <header class="mb-24" id="hero">
      <div class="flex items-center gap-3 mb-6">
        <div class="w-3 h-3 rounded-full bg-accent shadow-[0_0_8px_rgba(0,255,136,0.4)]"></div>
        <span class="text-muted text-xs tracking-widest uppercase">Research Lab</span>
      </div>

      <h1 class="text-4xl md:text-6xl font-bold text-white glow mb-6 leading-[1.1]">
        heuralabs<span class="text-accent">.</span>ai
      </h1>

      <p class="text-xl md:text-2xl text-gray-300 leading-relaxed max-w-2xl mb-3">
        Teaching machines to organize themselves<span class="text-accent">.</span>
      </p>
      <p class="text-sm text-gray-500 leading-relaxed max-w-xl">
        A solo research lab building autonomous agent economies and invisible learning infrastructure. Agents that self-govern, models that improve from their own output, and educational systems that learn from play.<span class="cursor-blink text-accent ml-0.5">_</span>
      </p>

      <div class="mt-8 flex flex-wrap gap-3 text-xs text-muted">
        <span class="border border-subtle px-2.5 py-1.5 rounded">multi-agent RL</span>
        <span class="border border-subtle px-2.5 py-1.5 rounded">continual learning</span>
        <span class="border border-subtle px-2.5 py-1.5 rounded">autonomous agents</span>
        <span class="border border-subtle px-2.5 py-1.5 rounded">educational AI</span>
      </div>
    </header>

    <!-- About (moved up) -->
    <section class="mb-24 reveal" id="about">
      <div class="flex items-center gap-3 mb-6">
        <span class="text-accent text-sm">$</span>
        <h2 class="text-sm text-muted tracking-widest uppercase">cat ./about</h2>
      </div>

      <div class="border border-border rounded-lg p-6 md:p-8 bg-surface/50 card-hover">
        <p class="text-gray-300 text-sm md:text-base leading-relaxed mb-4">
          Heuralabs is one person with a Mac Mini, a closet full of hardware, and a thesis: <span class="text-white font-medium">the next breakthrough in AI isn't bigger models — it's systems that learn to coordinate, improve from their own experience, and never stop adapting.</span>
        </p>
        <p class="text-gray-500 text-sm leading-relaxed">
          No funding rounds. No pitch decks. Just research, code, and shipping. Everything runs on local infrastructure, every system is designed to get smarter over time.
        </p>
      </div>
    </section>

    <!-- Divider -->
    <div class="border-t border-border/50 mb-24"></div>

    <!-- Launched -->
    <section class="mb-20" id="projects">
      <div class="flex items-center gap-3 mb-8 reveal">
        <span class="text-accent text-sm">$</span>
        <h2 class="text-sm text-muted tracking-widest uppercase">ls ./launched</h2>
        <div class="w-2 h-2 rounded-full bg-accent shadow-[0_0_6px_rgba(0,255,136,0.5)]"></div>
      </div>

      <div class="space-y-6 reveal-stagger">
        {launched.map((project) => (
          <article class="border border-accent/20 rounded-lg p-6 md:p-8 hover:border-accent/40 bg-surface/50 card-hover card-glow-green reveal">
            <div class="flex items-start justify-between gap-4 mb-3">
              <h3 class="text-xl font-semibold text-white">{project.name}</h3>
              <span class="text-xs px-2 py-0.5 rounded-full border border-accent/30 text-accent bg-accent/5 whitespace-nowrap">Live</span>
            </div>
            <p class="text-accent-dim text-sm mb-3 font-medium">{project.tagline}</p>
            <p class="text-gray-400 text-sm leading-relaxed mb-5">{project.description}</p>
            <div class="flex flex-wrap gap-2 mb-5">
              {project.tech.map((t) => (
                <span class="text-xs text-muted bg-bg px-2 py-0.5 rounded border border-border">{t}</span>
              ))}
            </div>
            <div class="flex gap-4">
              {project.links.map((link) => (
                <a href={link.href} target="_blank" rel="noopener noreferrer" class="text-xs text-accent hover:text-white transition-colors underline underline-offset-2 decoration-accent/30 hover:decoration-white/50">
                  {link.label} &rarr;
                </a>
              ))}
            </div>
          </article>
        ))}
      </div>
    </section>

    <!-- Building -->
    <section class="mb-20">
      <div class="flex items-center gap-3 mb-8 reveal">
        <span class="text-accent text-sm">$</span>
        <h2 class="text-sm text-muted tracking-widest uppercase">ls ./building</h2>
        <div class="w-2 h-2 rounded-full bg-yellow-500 shadow-[0_0_6px_rgba(234,179,8,0.4)]"></div>
      </div>

      <div class="space-y-6 reveal-stagger">
        {building.map((project) => (
          <article class="border border-yellow-500/15 rounded-lg p-6 hover:border-yellow-500/30 bg-surface/50 card-hover card-glow-yellow reveal">
            <div class="flex items-start justify-between gap-4 mb-3">
              <h3 class="text-lg font-semibold text-white">{project.name}</h3>
              <span class="text-xs px-2 py-0.5 rounded-full border border-yellow-500/30 text-yellow-500 bg-yellow-500/5 whitespace-nowrap">Building</span>
            </div>
            <p class="text-accent-dim text-sm mb-3 font-medium">{project.tagline}</p>
            <p class="text-gray-400 text-sm leading-relaxed mb-4">{project.description}</p>
            {'tech' in project && project.tech.length > 0 && (
              <div class="flex flex-wrap gap-2">
                {project.tech.map((t) => (
                  <span class="text-xs text-muted bg-bg px-2 py-0.5 rounded border border-border">{t}</span>
                ))}
              </div>
            )}
          </article>
        ))}
      </div>
    </section>

    <!-- Divider -->
    <div class="border-t border-border/50 mb-24"></div>

    <!-- Research -->
    <section class="mb-24" id="research">
      <div class="flex items-center gap-3 mb-4 reveal">
        <span class="text-accent text-sm">$</span>
        <h2 class="text-sm text-muted tracking-widest uppercase">ls ./research</h2>
        <div class="w-2 h-2 rounded-full bg-purple-500 shadow-[0_0_6px_rgba(168,85,247,0.4)]"></div>
      </div>
      <p class="text-gray-500 text-xs mb-8 reveal">Scoping and exploring — agentic RL, continual learning, and multi-agent coordination.</p>

      <div class="space-y-4 reveal-stagger">
        {research.map((project) => (
          <article class="border border-purple-500/10 rounded-lg p-5 hover:border-purple-500/25 bg-surface/30 card-hover card-glow-purple reveal">
            <div class="flex items-start justify-between gap-4 mb-2">
              <h3 class="text-sm font-semibold text-white">{project.name}</h3>
              <span class="text-[10px] px-2 py-0.5 rounded-full border border-purple-500/25 text-purple-400 bg-purple-500/5 whitespace-nowrap">Research</span>
            </div>
            <p class="text-purple-300/60 text-xs mb-2 font-medium">{project.tagline}</p>
            <p class="text-gray-500 text-xs leading-relaxed">{project.description}</p>
          </article>
        ))}
      </div>
    </section>

    <!-- Now -->
    <section class="mb-24 reveal" id="now">
      <div class="flex items-center gap-3 mb-6">
        <span class="text-accent text-sm">$</span>
        <h2 class="text-sm text-muted tracking-widest uppercase">cat ./now</h2>
        <span class="text-[10px] text-muted/50 ml-auto">updated feb 2026</span>
      </div>

      <div class="border border-border rounded-lg p-6 bg-surface/50 card-hover">
        <ul class="space-y-3 text-sm text-gray-400">
          <li class="flex items-start gap-3">
            <span class="text-accent mt-0.5">&#x25B8;</span>
            <span>Building the <span class="text-gray-200">contextual bandit</span> for DayOne agent-task matching — LinUCB sidecar, A/B traffic split, first 100 experiences collecting now</span>
          </li>
          <li class="flex items-start gap-3">
            <span class="text-yellow-500 mt-0.5">&#x25B8;</span>
            <span>Wiring up <span class="text-gray-200">LearningOS</span> quest system with real-time WebSocket feeds to the teacher dashboard</span>
          </li>
          <li class="flex items-start gap-3">
            <span class="text-purple-400 mt-0.5">&#x25B8;</span>
            <span>Reading up on <span class="text-gray-200">plasticity loss in continual RL</span> — Lyle et al. 2023, exploring whether periodic layer resets work for LLM adapters</span>
          </li>
        </ul>
      </div>
    </section>

    <!-- Terminal Easter Egg -->
    <div id="terminal" class="terminal-popup">
      <div class="bg-bg border-t border-accent/30 p-4 max-w-3xl mx-auto">
        <div id="terminal-output" class="text-xs text-gray-400 mb-2 max-h-32 overflow-y-auto"></div>
        <div class="flex items-center gap-2 text-xs">
          <span class="text-accent">guest@heuralabs:~$</span>
          <input type="text" id="terminal-input" class="terminal-input text-xs" autocomplete="off" spellcheck="false" />
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="border-t border-border pt-10 pb-16">
      <div class="mb-8 reveal">
        <p class="text-sm text-gray-400 mb-4">Interested in the work?</p>
        <a href="mailto:alec@heuralabs.ai" class="inline-flex items-center gap-2 text-sm text-accent hover:text-white transition-colors border border-accent/30 hover:border-accent/60 px-4 py-2 rounded-lg card-hover">
          alec@heuralabs.ai &rarr;
        </a>
      </div>
      <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 text-xs text-muted">
        <div class="flex items-center gap-4">
          <a href="https://github.com/heuralabs" target="_blank" rel="noopener noreferrer" class="hover:text-accent transition-colors">github</a>
          <span class="text-subtle">|</span>
          <span>press <kbd class="text-accent/60 border border-subtle px-1 rounded text-[10px]">`</kbd> for terminal</span>
        </div>
        <span>&copy; {new Date().getFullYear()} heuralabs</span>
      </div>
    </footer>

  </div>

  <script>
    // === Particle Network Canvas ===
    const canvas = document.getElementById('particles') as HTMLCanvasElement;
    const ctx = canvas.getContext('2d')!;
    let particles: { x: number; y: number; vx: number; vy: number }[] = [];
    const isMobile = window.innerWidth < 768;
    const CONNECT_DIST = isMobile ? 80 : 120;
    const PARTICLE_COUNT = isMobile ? 20 : 60;
    const MOUSE_RADIUS = 150;
    const MOUSE_FORCE = 0.02;
    let mouseX = -1000;
    let mouseY = -1000;

    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
    });
    document.addEventListener('mouseleave', () => {
      mouseX = -1000;
      mouseY = -1000;
    });

    function spawnParticles() {
      particles = [];
      for (let i = 0; i < PARTICLE_COUNT; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          vx: (Math.random() - 0.5) * 0.3,
          vy: (Math.random() - 0.5) * 0.3,
        });
      }
    }

    function resize() {
      const oldW = canvas.width;
      const oldH = canvas.height;
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      // Scale existing particle positions to new dimensions
      if (oldW && oldH) {
        const sx = canvas.width / oldW;
        const sy = canvas.height / oldH;
        for (const p of particles) {
          p.x *= sx;
          p.y *= sy;
        }
      }
    }
    resize();
    spawnParticles();
    window.addEventListener('resize', resize);

    function drawParticles() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw connections
      for (let i = 0; i < particles.length; i++) {
        for (let j = i + 1; j < particles.length; j++) {
          const dx = particles[i].x - particles[j].x;
          const dy = particles[i].y - particles[j].y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < CONNECT_DIST) {
            const opacity = (1 - dist / CONNECT_DIST) * 0.15;
            ctx.beginPath();
            ctx.moveTo(particles[i].x, particles[i].y);
            ctx.lineTo(particles[j].x, particles[j].y);
            ctx.strokeStyle = `rgba(0, 255, 136, ${opacity})`;
            ctx.lineWidth = 0.5;
            ctx.stroke();
          }
        }
      }

      // Draw particles
      for (const p of particles) {
        // Mouse interaction — gentle repel
        const mdx = p.x - mouseX;
        const mdy = p.y - mouseY;
        const mDist = Math.sqrt(mdx * mdx + mdy * mdy);
        if (mDist < MOUSE_RADIUS && mDist > 0) {
          const force = (1 - mDist / MOUSE_RADIUS) * MOUSE_FORCE;
          p.vx += (mdx / mDist) * force;
          p.vy += (mdy / mDist) * force;
        }
        // Dampen velocity
        p.vx *= 0.99;
        p.vy *= 0.99;

        ctx.beginPath();
        ctx.arc(p.x, p.y, 1.5, 0, Math.PI * 2);
        ctx.fillStyle = 'rgba(0, 255, 136, 0.3)';
        ctx.fill();

        // Move
        p.x += p.vx;
        p.y += p.vy;

        // Wrap
        if (p.x < 0) p.x = canvas.width;
        if (p.x > canvas.width) p.x = 0;
        if (p.y < 0) p.y = canvas.height;
        if (p.y > canvas.height) p.y = 0;
      }

      requestAnimationFrame(drawParticles);
    }
    drawParticles();

    // === Terminal Boot Sequence (full-screen overlay) ===
    const bootLines = [
      { text: '> initializing heuralabs kernel...', delay: 0 },
      { text: '> loading research modules...', delay: 250 },
      { text: '> mounting project filesystem...', delay: 500 },
      { text: '> establishing agent connections...', delay: 750 },
      { text: '> all systems online.', delay: 1050, accent: true },
    ];

    const overlay = document.getElementById('boot-overlay')!;
    const bootEl = document.getElementById('boot-sequence')!;
    const mainContent = document.getElementById('main-content')!;

    bootLines.forEach(({ text, delay, accent }) => {
      setTimeout(() => {
        const line = document.createElement('div');
        line.textContent = text;
        if (accent) line.className = 'text-accent font-semibold';
        bootEl.appendChild(line);
      }, delay);
    });

    // Fade out overlay, reveal page
    setTimeout(() => {
      overlay.style.transition = 'opacity 0.6s ease';
      overlay.style.opacity = '0';
      overlay.style.pointerEvents = 'none';
      mainContent.style.transition = 'opacity 0.6s ease';
      mainContent.style.opacity = '1';
    }, 1700);

    setTimeout(() => {
      overlay.remove();
    }, 2300);

    // === Sticky Nav (show after scrolling past hero) ===
    const stickyNav = document.getElementById('sticky-nav')!;
    const hero = document.getElementById('hero')!;

    const navObserver = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          stickyNav.style.transform = 'translateY(-100%)';
        } else {
          stickyNav.style.transform = 'translateY(0)';
        }
      },
      { threshold: 0, rootMargin: '0px' }
    );
    // Start observing hero after boot overlay clears
    setTimeout(() => navObserver.observe(hero), 1800);

    // Highlight active section in nav
    const navLinks = stickyNav.querySelectorAll('a[href^="#"]');
    const sections = Array.from(navLinks).map(link => {
      const id = link.getAttribute('href')!.slice(1);
      return { link, el: document.getElementById(id)! };
    });

    const activeObserver = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          const match = sections.find(s => s.el === entry.target);
          if (match) {
            if (entry.isIntersecting) {
              navLinks.forEach(l => l.classList.remove('text-accent'));
              match.link.classList.add('text-accent');
            }
          }
        });
      },
      { threshold: 0.3 }
    );
    setTimeout(() => sections.forEach(s => activeObserver.observe(s.el)), 1800);

    // === Scroll-triggered reveals ===
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.1, rootMargin: '0px 0px -40px 0px' }
    );

    // Start observing after boot sequence reveals page
    setTimeout(() => {
      document.querySelectorAll('.reveal').forEach((el) => observer.observe(el));
    }, 1800);

    // === Terminal Easter Egg ===
    const terminal = document.getElementById('terminal')!;
    const termInput = document.getElementById('terminal-input') as HTMLInputElement;
    const termOutput = document.getElementById('terminal-output')!;
    let termOpen = false;

    const responses: Record<string, string> = {
      help: 'available commands: help, about, projects, stack, contact, ping, clear, exit',
      about: 'solo AI research lab. autonomous agents + learning infrastructure. mac mini in a closet.',
      projects: 'dayone (live) · learningos (building) · dayone-rl (building) · 6 research threads active',
      stack: 'next.js · fastapi · postgres · redis · astro · tailwind · docker · cloudflare tunnels · quantized llms',
      contact: 'alec@heuralabs.ai',
      ping: 'pong. latency: 0.42ms (it\'s localhost)',
      clear: '__CLEAR__',
      exit: '__EXIT__',
    };

    document.addEventListener('keydown', (e) => {
      if (e.key === '`' && !termOpen) {
        e.preventDefault();
        termOpen = true;
        terminal.classList.add('open');
        termInput.focus();
      } else if (e.key === 'Escape' && termOpen) {
        termOpen = false;
        terminal.classList.remove('open');
        termInput.blur();
      }
    });

    termInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const cmd = termInput.value.trim().toLowerCase();
        termInput.value = '';
        if (!cmd) return;

        if (cmd === 'clear') {
          termOutput.innerHTML = '';
          return;
        }
        if (cmd === 'exit') {
          termOpen = false;
          terminal.classList.remove('open');
          termInput.blur();
          return;
        }

        const response = responses[cmd] || `command not found: ${cmd}. type "help" for available commands.`;
        const line = document.createElement('div');
        line.innerHTML = `<span class="text-accent">$</span> ${cmd}<br/><span class="text-gray-500">${response}</span>`;
        line.className = 'mb-1';
        termOutput.appendChild(line);
        termOutput.scrollTop = termOutput.scrollHeight;
      }
    });
  </script>
</Layout>
